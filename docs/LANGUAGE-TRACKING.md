# Automated Language Statistics for GitHub Profiles

This repository includes an automated system that generates a visual representation of programming languages used across all your public GitHub repositories. The chart updates daily and is displayed as an SVG donut chart in your profile README.

## What It Does

The system:
- Fetches all your public, non-forked, non-archived repositories via the GitHub API
- Aggregates language statistics (bytes of code) for each programming language
- Generates a styled SVG donut chart showing the top 10 languages
- Automatically commits and pushes the updated chart daily
- Displays the chart in your GitHub profile README

## How It Works

The automation consists of three main components:

### 1. Generation Script (`scripts/generate-langs.js`)

A Node.js script that:
- Authenticates with the GitHub API using a token
- Retrieves all repositories for a specified username
- Filters out forks and archived repositories
- Calls the `/repos/{owner}/{repo}/languages` endpoint for each repo
- Aggregates language byte counts across all repositories
- Renders an SVG donut chart with legend and statistics
- Saves the output to `assets/langs-donut.svg`

The script uses the GitHub Languages API, which provides byte counts for each language detected in a repository. These counts are based on GitHub's language detection algorithm (powered by Linguist).

### 2. GitHub Actions Workflow (`.github/workflows/update-lang-chart.yml`)

A scheduled workflow that:
- Runs daily at 06:00 UTC (configurable via cron expression)
- Can also be triggered manually via workflow_dispatch
- Checks out the repository with full history
- Installs Node.js and dependencies
- Executes the generation script with `GITHUB_TOKEN`
- Commits and pushes changes if the SVG file was modified

### 3. SVG Output (`assets/langs-donut.svg`)

A dynamically generated SVG file featuring:
- Dark-themed background matching GitHub's design
- Donut chart with color-coded language segments
- Legend showing language names, percentages, and byte counts
- Generation timestamp and total code size
- Responsive design (640x240px default)

## Setup Instructions

Follow these steps to implement this system in your own GitHub profile repository:

### Step 1: Create the Directory Structure

```bash
mkdir -p .github/workflows scripts assets
```

### Step 2: Add the Generation Script

Create `scripts/generate-langs.js` with the following content:

```javascript
#!/usr/bin/env node
const fs = require('fs');
const path = require('path');
const fetch = global.fetch || require('node-fetch');

const USERNAME = process.argv[2] || process.env.INPUT_USERNAME ||
  (process.env.GITHUB_REPOSITORY ? process.env.GITHUB_REPOSITORY.split('/')[0] : 'YOUR_USERNAME');
const TOKEN = process.env.GITHUB_TOKEN || process.env.GH_TOKEN || null;
const OUT_PATH = path.resolve(__dirname, '..', 'assets', 'langs-donut.svg');

async function request(url) {
  const headers = { 'Accept': 'application/vnd.github+json' };
  if (TOKEN) headers['Authorization'] = `Bearer ${TOKEN}`;
  const res = await fetch(url, { headers });
  if (!res.ok) throw new Error(`${res.status} ${res.statusText} - ${url}`);
  return res.json();
}

async function fetchAllRepos() {
  const repos = [];
  let page = 1;
  while (true) {
    const url = `https://api.github.com/users/${USERNAME}/repos?per_page=100&page=${page}`;
    const data = await request(url);
    if (!data || data.length === 0) break;
    repos.push(...data);
    page += 1;
  }
  return repos.filter(r => !r.fork && !r.archived);
}

async function fetchLanguages(owner, repo) {
  const url = `https://api.github.com/repos/${owner}/${repo}/languages`;
  return request(url);
}

function formatBytes(bytes) {
  if (bytes === 0) return '0 B';
  const units = ['B','KB','MB','GB'];
  let u = 0;
  let val = bytes;
  while (val >= 1024 && u < units.length-1) { val /= 1024; u++; }
  return `${val.toFixed(1)} ${units[u]}`;
}

function makeSvg(langArray, totalBytes) {
  const width = 640;
  const height = 240;
  const r = 60;
  const cx = 150;
  const cy = 120;
  const circumference = 2 * Math.PI * r;

  const colors = [
    '#6366F1','#EF4444','#F97316','#F59E0B','#10B981','#06B6D4',
    '#3B82F6','#8B5CF6','#EC4899','#94A3B8'
  ];

  let cumulative = 0;
  const segments = langArray.map((l, idx) => {
    const pct = l.bytes / totalBytes;
    const dash = `${(pct * circumference).toFixed(2)} ${circumference.toFixed(2)}`;
    const offset = -(cumulative * circumference).toFixed(2);
    cumulative += pct;
    return { ...l, color: colors[idx % colors.length], dash, offset };
  });

  const legendX = 330;
  const legendY = 40;
  const legendGap = 20;
  const now = new Date().toISOString();

  const svgParts = [];
  svgParts.push(`<!-- Generated by scripts/generate-langs.js on ${now} -->`);
  svgParts.push(`<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">`);
  svgParts.push(`<style>
    .label{font: 12px 'Segoe UI', Roboto, Arial; fill:#cbd5e1}
    .legend{font: 12px 'Segoe UI', Roboto, Arial; fill:#e2e8f0}
    .title{font: 14px 'Segoe UI', Roboto, Arial; fill:#ffffff; font-weight:600}
  </style>`);
  svgParts.push(`<rect width="100%" height="100%" fill="#0b1220" rx="8"/>`);
  svgParts.push(`<text x="20" y="26" class="title">Languages — aggregated across public repos</text>`);
  svgParts.push(`<g transform="translate(${cx}, ${cy}) rotate(-90)">`);
  svgParts.push(`<circle r="${r}" cx="0" cy="0" fill="transparent" stroke="#11203a" stroke-width="20" />`);

  segments.forEach(s => {
    svgParts.push(`<circle r="${r}" cx="0" cy="0" fill="transparent" stroke="${s.color}" stroke-width="20" stroke-linecap="butt"
      stroke-dasharray="${s.dash}" stroke-dashoffset="${s.offset}" transform="rotate(0)" />`);
  });

  svgParts.push(`</g>`);
  svgParts.push(`<g transform="translate(${legendX},${legendY})">`);

  langArray.forEach((l, i) => {
    const y = i * legendGap;
    const color = colors[i % colors.length];
    const pct = ((l.bytes / totalBytes) * 100).toFixed(1);
    svgParts.push(`<rect x="0" y="${y-12}" width="12" height="12" fill="${color}" rx="2"/>`);
    svgParts.push(`<text x="18" y="${y - 2}" class="legend">${l.lang} — ${pct}% (${formatBytes(l.bytes)})</text>`);
  });

  svgParts.push(`</g>`);
  svgParts.push(`<text x="20" y="216" class="label">Total: ${formatBytes(totalBytes)} — Generated: ${now.split('T')[0]}</text>`);
  svgParts.push(`</svg>`);

  return svgParts.join('\n');
}

(async function main(){
  try {
    console.log('Fetching repos for', USERNAME);
    const repos = await fetchAllRepos();
    console.log(`Found ${repos.length} repos (filtered fork/archived).`);

    const totals = {};
    for (const repo of repos) {
      try {
        const langs = await fetchLanguages(USERNAME, repo.name);
        for (const [lang, bytes] of Object.entries(langs)) {
          totals[lang] = (totals[lang] || 0) + bytes;
        }
      } catch (e) {
        console.warn('Failed to fetch languages for', repo.name, e.message);
      }
    }

    const totalBytes = Object.values(totals).reduce((a,b)=>a+b,0);
    if (totalBytes === 0) {
      const placeholder = `<!-- Generated on ${new Date().toISOString()} -->\n<svg xmlns="http://www.w3.org/2000/svg" width="400" height="120"><rect width="100%" height="100%" fill="#0b1220" rx="8"/><text x="20" y="40" fill="#e2e8f0">No language data available</text></svg>`;
      fs.mkdirSync(path.dirname(OUT_PATH), { recursive: true });
      fs.writeFileSync(OUT_PATH, placeholder, 'utf8');
      console.log('Wrote placeholder SVG (no language bytes).');
      return;
    }

    const langArray = Object.entries(totals)
      .map(([lang, bytes]) => ({lang, bytes}))
      .sort((a,b)=>b.bytes-a.bytes)
      .slice(0,10);

    const svg = makeSvg(langArray, totalBytes);
    fs.mkdirSync(path.dirname(OUT_PATH), { recursive: true });
    fs.writeFileSync(OUT_PATH, svg, 'utf8');
    console.log('Wrote', OUT_PATH);
  } catch (err) {
    console.error('Error:', err);
    process.exit(1);
  }
})();
```

**Important:** Replace `'YOUR_USERNAME'` on line 5 with your actual GitHub username as a fallback.

### Step 3: Create the GitHub Actions Workflow

Create `.github/workflows/update-lang-chart.yml`:

```yaml
name: Update languages chart

on:
  schedule:
    - cron: '0 6 * * *' # Daily at 06:00 UTC
  workflow_dispatch: {}

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install deps
        run: npm ci || npm install

      - name: Generate languages SVG
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: npm run generate-langs

      - name: Commit & push if changed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add assets/langs-donut.svg || true
          if ! git diff --cached --quiet; then
            git commit -m "chore: update languages chart"
            git push
          else
            echo "No changes to commit"
          fi
```

### Step 4: Add Package Configuration

Create or update `package.json` in the repository root:

```json
{
  "name": "github-profile-tools",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "generate-langs": "node scripts/generate-langs.js"
  },
  "engines": {
    "node": ">=18"
  }
}
```

### Step 5: Update Your README

Add the following to your `README.md` where you want the chart to appear:

```markdown
## GitHub Stats

<p align="center">
  <img src="assets/langs-donut.svg" alt="Languages distribution" />
</p>
```

### Step 6: Initial Run and Commit

1. Run the script locally to generate the initial SVG:
   ```bash
   npm run generate-langs
   ```

2. Commit all files:
   ```bash
   git add .github/ scripts/ assets/ package.json README.md
   git commit -m "Add automated language tracking"
   git push
   ```

3. The workflow will now run automatically every day at 06:00 UTC. You can also trigger it manually:
   - Go to your repository on GitHub
   - Click "Actions" tab
   - Select "Update languages chart"
   - Click "Run workflow"

## Customization Options

### Change Update Schedule

Modify the cron expression in `.github/workflows/update-lang-chart.yml`:
- `'0 6 * * *'` - Daily at 06:00 UTC
- `'0 */6 * * *'` - Every 6 hours
- `'0 0 * * 0'` - Weekly on Sunday at midnight

### Customize Chart Appearance

Edit the `makeSvg()` function in `scripts/generate-langs.js`:

**Chart dimensions:**
```javascript
const width = 640;
const height = 240;
```

**Donut size:**
```javascript
const r = 60; // radius
const cx = 150; // center X
const cy = 120; // center Y
```

**Color palette:**
```javascript
const colors = [
  '#6366F1', // indigo
  '#EF4444', // red
  '#F97316', // orange
  // Add more colors as needed
];
```

**Background color:**
```javascript
svgParts.push(`<rect width="100%" height="100%" fill="#0b1220" rx="8"/>`);
```

### Display More/Fewer Languages

Change the slice limit in the script (line 152):
```javascript
.slice(0, 10); // Show top 10 languages
```

### Filter Specific Languages

Add filtering logic after language aggregation:
```javascript
delete totals['HTML']; // Remove HTML from stats
delete totals['CSS'];  // Remove CSS from stats
```

## Troubleshooting

### Chart Not Updating

1. Check the Actions tab for workflow errors
2. Verify `GITHUB_TOKEN` permissions in repository settings
3. Ensure the workflow has write access to contents

### Rate Limiting

The GitHub API has rate limits:
- Authenticated requests: 5,000 per hour
- The script uses one request per repository + one for the repo list

If you have many repositories, consider:
- Running less frequently (weekly instead of daily)
- Implementing caching mechanisms

### Script Errors

Run locally with debugging:
```bash
GITHUB_TOKEN=your_token node scripts/generate-langs.js your_username
```

## Technical Details

### API Endpoints Used

- `GET /users/{username}/repos` - Fetch user repositories
- `GET /repos/{owner}/{repo}/languages` - Get language statistics

### Authentication

The script uses the `GITHUB_TOKEN` environment variable, which is automatically provided by GitHub Actions. For local testing, create a personal access token with `repo` scope.

### File Output

The generated SVG is a standalone file that can be:
- Embedded directly in README files
- Linked from external websites
- Viewed in any modern browser

## Credits

This implementation was inspired by various GitHub profile enhancement projects and uses the GitHub REST API v3 for data collection.

## License

Feel free to use and modify this code for your own GitHub profile. No attribution required.
